# scope: planet
planet_genso_job_buff_modifier = {
	base = 1
	add = modifier:planet_barrier_capacity_add
	subtract = modifier:planet_barrier_capacity_use
	ceiling = yes
	min = 0
	max = 1
}
# scope: planet
planet_available_barrier_capacity = {
	base = 1
	add = modifier:planet_barrier_capacity_add
	subtract = modifier:planet_barrier_capacity_use
	min = 0
	max = 1
}
# scope: planet
planet_base_faith_strength = {
	base = 0
	add = trigger:num_sapient_pops
	modifier = {
		owner = {
			has_ascension_perk = ap_toho2
		}
		multiply = 1.2
	}
	modifier = {
		owner = {
			has_ascension_perk = ap_toho3
		}
		multiply = 1.2
	}
	modifier = {
		owner = {
			has_ascension_perk = ap_toho4
		}
		multiply = 1.2
	}
	min = 0
}
# scope: planet
planet_faith_sum = {
	base = 0
	add = modifier:planet_faith_strength_add
	add = value:planet_base_faith_strength
	min = 0
}
# scope: planet
planet_barrier_pressure_ratio = {
	base = 1
	multiply = modifier:planet_barrier_capacity_use
	divide = modifier:planet_barrier_capacity_add
	min = 0
	max = 3
}
# scope: planet
# update planet's planet_barrier_pressure_ratio variable before using this
planet_weak_genso_job_produce_barrier_modifier = {
	base = 0
	add = value:planet_barrier_pressure_ratio
	subtract = 1.5
	square = yes
	multiply = -1
	add = 1.25
	modifier = {
		check_variable = {
			which = planet_barrier_pressure_ratio
			value <= 1
		}
		set = 1
	}
	modifier = {
		check_variable = {
			which = planet_barrier_pressure_ratio
			value >= 2.5
		}
		set = 0.25
	}
	min = 0
}
# scope: planet
# 最终输出的弱产出加成倍率
planet_weak_genso_job_produce_faith_modifier = {
	base = 0
	add = value:planet_base_faith_strength
	add = modifier:planet_faith_strength_add
	square_root = yes
	divide = 20
	multiply = value:planet_weak_genso_job_produce_barrier_modifier
	min = 0
	# add = 1
}
# scope: planet
# 最终输出的强产出加成倍率
planet_strong_genso_job_produce_faith_modifier = {
	base = 0
	add = value:planet_base_faith_strength
	add = modifier:planet_faith_strength_add
	square_root = yes
	divide = 10
	multiply = value:planet_weak_genso_job_produce_barrier_modifier
	min = 0
	# add = 1
}
# scope: planet
planet_weak_genso_job_upkeep_barrier_modifier = {
	base = 0
	add = value:planet_barrier_pressure_ratio
	subtract = 1
	min = 0
	square_root = yes
	add = 1
	modifier = {
		check_variable = {
			which = planet_barrier_pressure_ratio
			value <= 1
		}
		set = 1
	}
	min = 1
}
# scope: planet
# 最终输出的弱维护费加成倍率
planet_weak_genso_job_upkeep_faith_modifier = {
	base = 0
	add = value:planet_base_faith_strength
	add = modifier:planet_faith_strength_add
	square_root = yes
	divide = 18
	multiply = value:planet_weak_genso_job_upkeep_barrier_modifier
	min = 0
	# add = 1
}
# scope: planet
# 最终输出的强维护费加成倍率
planet_strong_genso_job_upkeep_faith_modifier = {
	base = 0
	add = value:planet_base_faith_strength
	add = modifier:planet_faith_strength_add
	square_root = yes
	divide = 9
	multiply = value:planet_weak_genso_job_upkeep_barrier_modifier
	min = 0
	# add = 1
}
# scope: planet
planet_part1_sp_upkeep_faith_pressure_modifier = {
	base = -20
	add = modifier:planet_faith_strength_pressure
	min = 0
	mult = 0.01
}
# scope: planet
planet_part2_sp_upkeep_faith_pressure_modifier = {
	base = -20
	subtract = modifier:planet_faith_strength_add
	subtract = value:planet_base_faith_strength
	add = modifier:planet_faith_strength_pressure
	min = 0
	mult = 0.04
}
# scope: planet
# 最终输出的灵力维护费倍率
planet_sp_upkeep_faith_pressure_modifier = {
	base = 1
	add = value:planet_part1_sp_upkeep_faith_pressure_modifier
	add = value:planet_part2_sp_upkeep_faith_pressure_modifier
}
# scope: planet
spth_police_station_factor = {
	base = 0
	add = trigger:num_pops
	square_root = yes
	multiply = planet_weak_genso_job_produce_barrier_modifier
	min = 0
}
# 人口组装速度倍率
# (1+0.10*(岗位/sqrt(人口)))*(1+0.1*龙神像启用数量)
planet_genso_cloner_modifier = {
	base = 0
	modifier = {
		free_jobs > 0
		add = trigger:free_jobs
	}
	divide = value:planet_genso_cloner_divider
	multiply = 0.10
	add = 1
	modifier = {
		OR = {
			free_jobs <= 3
			free_housing <= 6
		}
		multiply = 0
	}
	multiply = value:planet_genso_cloner_buf
	modifier = {
		NOT = { has_deposit = d_hakurei_barrier }
		mult = 0.5
	}
	min = 0
	max = 8
}
planet_genso_cloner_divider = {
	base = 1
	add = trigger:num_pops
	square_root = yes
}
# 同类型建筑加成
planet_genso_cloner_buf = {
	base = 0
	complex_trigger_modifier = {
		trigger = num_buildings
		parameters = { type = building_spth_cloner disabled = no }
		multiplier = 0.10
		mode = add
	}
	add = 1
	min = 0
}
# 士兵岗位统计
planet_genso_soldier_counter = {
	base = 0
	complex_trigger_modifier = {
		trigger = num_assigned_jobs
		parameters = {
			job = soldier
		}
		mode = add
	}
	complex_trigger_modifier = {
		trigger = num_assigned_jobs
		parameters = {
			job = genso_enforcer
		}
		mode = add
	}
	multiply = value:planet_weak_genso_job_produce_barrier_modifier
	min = 0
}

# 研究中心加成
# [2, 3.2]*ceil(sqrt(人口数)*(1+结界承载力使用/max(1, 结界承载力))*结界承载力人口buff)
# 均为planet scope
planet_genso_research_buff_capacity_add_factor = {
	base = 0
	add = modifier:planet_barrier_capacity_add
	min = 1
}
planet_genso_research_buff_capacity_factor = {
	base = 0
	add = modifier:planet_barrier_capacity_use
	divide = value:planet_genso_research_buff_capacity_add_factor
	add = 1
}
planet_genso_research_buff_building_factor = {
	base = 1
	complex_trigger_modifier = {
		trigger = num_buildings
		parameters = {
			type = building_spth_research_base_1
		}
		mode = add
	}
	complex_trigger_modifier = {
		trigger = num_buildings
		parameters = {
			type = building_spth_research_lab_engineering
		}
		mode = add
	}
	complex_trigger_modifier = {
		trigger = num_buildings
		parameters = {
			type = building_spth_research_lab_physics
		}
		mode = add
	}
	complex_trigger_modifier = {
		trigger = num_buildings
		parameters = {
			type = building_spth_research_lab_society
		}
		mode = add
	}
	max = 5.76
}
planet_genso_research_buff_modifier = {
	base = 0
	add = trigger:num_pops
	multiply = value:planet_genso_research_buff_building_factor
	square_root = yes
	multiply = value:planet_genso_research_buff_capacity_factor
	ceiling = yes
	multiply = 2.4
	min = 1
	max = 125
}
spth_planet_reactor_upkeep_mult = {
    base = 0
    modifier = {
        NOT = { is_variable_set = spth_planet_reactor_upkeep_mult }
        add = 50
    }
    add = planet.spth_planet_reactor_upkeep_mult
    min = 0
}
spth_planet_reactor_procude_mult = {
    base = 0
    add = value:spth_planet_reactor_upkeep_mult
    square_root = yes
    multiply = 5
    min = 0
}

spth_num_chip_slave_raw = {
	base = 0
	complex_trigger_modifier = {
		trigger = count_owned_pop
		trigger_scope = planet
		mode = add
	}
}
spth_num_chip_slave = {
	base = 0
	complex_trigger_modifier = {
		trigger = count_owned_pop
		trigger_scope = planet
		mode = add
	}
	divide = $divide$
}
spth_num_chip_slave_sqrt = {
	base = 0
	complex_trigger_modifier = {
		trigger = count_owned_pop
		trigger_scope = planet
		mode = add
	}
	square_root = yes
}
spth_num_chip_slave_display = {
	base = 0
	complex_trigger_modifier = {
		trigger = count_owned_pop
		trigger_scope = planet
		mode = add
	}
	mult = $mul$
}
spth_convert_rate_produce_add_districts = {
	base = 1
	complex_trigger_modifier = {
		trigger = num_districts
		parameters = { type = $district$ }
		mode = mult
	}
	min = 1
}
spth_convert_rate_produce_add = {
	base = 0
	add = value:spth_num_chip_slave|divide|20|
	add = value:spth_convert_rate_produce_add_districts|district|$district$|
}
