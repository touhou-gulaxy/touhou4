# planet scope
count_planet_add_miko = {
	modifier = {
		add = 1
		has_active_building = building_colony_shelter
	}
	modifier = {
		add = 1
		has_active_building = building_capital
	}
	modifier = {
		add = 2
		has_active_building = building_major_capital
	}
	modifier = {
		add = 3
		has_active_building = building_system_capital
	}
	modifier = {
		add = 4
		has_active_building = building_imperial_capital
	}
	modifier = {
		add = 4
		has_active_building = building_spth_old_shirne
	}
	modifier = {
		add = 5
		has_active_building = building_spth_planet_shirne
	}
	# 涅槃圣权
	modifier = {
		add = 4
		has_active_building = building_ancient_palace
	}
	modifier = {
		add = 5
		has_active_building = building_nirvana_empire_palace
	}
	modifier = {
		add = 1
		has_active_building = building_hab_capital
	}
	modifier = {
		add = 2
		has_active_building = building_hab_major_capital
	}
	modifier = {
		add = 3
		has_active_building = building_hab_system_capital
	}
	modifier = {
		add = 1
		has_active_building = building_resort_capital
	}
	modifier = {
		add = 2
		has_active_building = building_resort_major_capital
	}
	modifier = {
		add = 1
		has_active_building = building_slave_capital
	}
	modifier = {
		add = 2
		has_active_building = building_slave_major_capital
	}
}

ship_spth_shield_efficiency_count = {
	base = 0
	add = modifier:ship_spth_shield_efficiency
	min = 0
}
ship_spth_armor_efficiency_count = {
	base = 0
	add = modifier:ship_spth_armor_efficiency
	min = 0
}
ship_spth_shield_efficiency_value = {
	base = 0
	add = modifier:ship_spth_shield_efficiency
	min = -1
}
ship_spth_armor_efficiency_value = {
	base = 0
	add = modifier:ship_spth_armor_efficiency
	min = -1
}
spth_shield_damage_debuff_value = {
	base = 0
	add = modifier:ship_shield_damage_mult
	add = spth_shield_damage_debuff
}
spth_armor_damage_debuff_value = {
	base = 0
	add = modifier:ship_armor_damage_mult
	add = spth_armor_damage_debuff
}
spth_months_passed = {
	base = 0
	add = trigger:days_passed
	divide = 30
	floor = yes
}
spth_current_month = {
	base = 1
	add = value:spth_months_passed
	modulo = 12
}
spth_current_day = {
	base = 1
	add = trigger:days_passed
	modulo = 30
}
spth_current_year = {
	base = 2200
	add = trigger:years_passed
}
spth_leader_level = {
	base = 0
	add = trigger:has_level
	min = 0
}
spth_leader_experience = {
	base = 0
	add = trigger:has_experience
	min = 0
}
spth_upgrade_leader_cost_lingli = {
	base = 50
	multiply = trigger:has_level
	add = 350
}
spth_upgrade_leader_cost_fuka = {
	base = 10
	multiply = trigger:has_level
	add = 30
}
spth_ship_death_sakura_point = {
	base = 0
	add = modifier:ship_spth_story_crisis_titan_energy_weapon_counter
	square_root = yes
	add = 1
	multiply = 0.5
}

spth_story_crisis_titan_generic_damage = {
	base = 0
	add = modifier:weapon_type_lingli_weapon_damage_mult
	add = modifier:weapon_type_white_fog_random_weapon_damage_mult
	min = 0
}
spth_story_crisis_titan_generic_fire_rate = {
	base = 0
	add = modifier:weapon_type_lingli_weapon_fire_rate_mult
	add = modifier:weapon_type_white_fog_random_weapon_fire_rate_mult
	min = 0
}

spth_story_crisis_extra_energy_damage = {
	base = 0
	add = modifier:weapon_type_energy_weapon_damage_mult
	multiply = 1.44
	add = spth_story_crisis_extra_energy_var
	add = value:spth_story_crisis_extra_energy_damage_ex
	min = 0
}
spth_story_crisis_extra_energy_fire_rate_base = {
	base = 0
	add = modifier:weapon_type_kinetic_weapon_fire_rate_mult
	multiply = 0.20
	modifier = {
		multiply = 0.8
		check_variable_arithmetic = {
			which = value:spth_months_passed
			value <= 6
		}
	}
	min = 0
}
spth_story_crisis_extra_energy_fire_rate = {
	base = 0
	add = value:spth_story_crisis_extra_energy_fire_rate_base
	max = 7
}
spth_story_crisis_extra_energy_damage_ex = {
	base = 0
	add = value:spth_story_crisis_extra_energy_fire_rate_base
	subtract = 7
	min = 0
}

spth_story_crisis_extra_kinetic_damage = {
	base = 0
	add = modifier:weapon_type_kinetic_weapon_damage_mult
	multiply = 1.44
	add = spth_story_crisis_extra_kinetic_var
	add = value:spth_story_crisis_extra_kinetic_damage_ex
	min = 0
}
spth_story_crisis_extra_kinetic_fire_rate_base = {
	base = 0
	add = modifier:weapon_type_energy_weapon_fire_rate_mult
	multiply = 0.20
	modifier = {
		multiply = 0.8
		check_variable_arithmetic = {
			which = value:spth_months_passed
			value >= 7
		}
	}
	min = 0
}
spth_story_crisis_extra_kinetic_fire_rate = {
	base = 0
	add = value:spth_story_crisis_extra_kinetic_fire_rate_base
	max = 7
}
# max(0, 能量伤害*倍率-7)
spth_story_crisis_extra_kinetic_damage_ex = {
	base = 0
	add = value:spth_story_crisis_extra_kinetic_fire_rate_base
	subtract = 7
	min = 0
}

leader_trait_th_skill_producer_1_factor = {
	base = 0
	modifier = {
		exists = fleet
		add = fleet.trigger:num_ships
	}
	modifier = {
		exists = planet
		add = planet.trigger:num_armies
	}
	min = 0
}

spth_p_max_ex_factor = {
	base = 0
	add = spth_number_p
	divide = 16
	add = 1
}
spth_super_carrier_computer_inv_used = {
	base = 0
	add = spth_super_carrier_inv_counter
}
spth_super_carrier_computer_inv_rest = {
	base = 10
	subtract = spth_super_carrier_inv_counter
}
spth_super_carrier_computer_cooldown = {
	base = 0
	add = spth_super_carrier_combat_days
	modulo = 45
	subtract = 45
	abs = yes
}

spth_get_ship_size = {
	base = 0
	add = trigger:ship_size_multiplier
	# in case some idiot fill an negative or zero value into ship_size_multiplier
	abs = yes
	min = 0
}
spth_get_ship_size_square_root = {
	base = 0
	add = trigger:ship_size_multiplier
	# in case some idiot fill an negative value or zero into ship_size_multiplier
	abs = yes
	square_root = yes
	min = 0
}
spth_reduce_shield_value = {
	base = 0
	add = trigger:has_shield_hp
	mult = $percent$
	divide = 100
	floor = yes
	min = 0
	max = value:spth_reduce_shield_value_max|subtract|$subtract$|factor|$factor$|
}
spth_reduce_shield_value_max = {
	base = 0
	add = trigger:has_shield_hp
	subtract = $subtract$
	mult = $factor$
	floor = yes
	min = 0
}
yukari_kamikakushi_chance_base = {
	base = 100
	subtract = value:spth_get_ship_size_square_root
	min = 0
	max = 100
}
yukari_kamikakushi_chance_reduce = {
	base = 0
	add = value:spth_get_ship_size_square_root
	min = 0
	max = 100
}
yukari_kamikakushi_hardening_reduce_value = {
	base = 0
	add = value:spth_get_ship_size
	multiply = 0.02
	min = 0
}
yukari_kamikakushi_reduce_value = {
	base = 0
	add = value:spth_get_ship_size
	square_root = yes
	multiply = 0.05
	min = 0.05
	max = 0.75
}

spth_supercarrier_inv_counter = {
	base = 10
	modifier = {
		event_target:is_spth_boss = {
			is_variable_set = spth_super_carrier_inv_counter
		}
		subtract = event_target:is_spth_boss.spth_super_carrier_inv_counter
	}
	max = 10
	min = 0
}
spth_is_boss_limt_hp = {
	base = 0
	add = event_target:is_spth_boss.trigger:has_hp
	# multiply = value:spth_supercarrier_inv_counter
}

ship_spth_extra_life_power_down = {
	base = 0
	add = modifier:ship_spth_extra_life_power_down
	min = -0.9
	max = 0
}
ship_spth_extra_life_power_down_value = {
	base = 0
	# +100% damage, down = 0.1(10%) -> reduce_value = 0.1*100% = 10%
	modifier = {
		check_modifier_value = { modifier = ship_weapon_damage value > 0 }
		add = modifier:ship_weapon_damage
		multiply = value:ship_spth_extra_life_power_down
	}
	# +0% damage, down = 0.1 -> reduce_value = down = 10%
	# -50% damage, down = 0.1 -> reduce_value = down = 10%
	# if damage + 0.9 < down, do nothing.
	modifier = {
		check_modifier_value = { modifier = ship_weapon_damage value <= 0 }
		check_variable_arithmetic = {
			which = modifier:ship_weapon_damage add = 0.9
			value >= value:ship_spth_extra_life_power_down
		}
		add = value:ship_spth_extra_life_power_down
	}
}

spth_space_shrine_extra_life_rest = {
	base = 0
	complex_trigger_modifier = {
		trigger_scope = event_target:player_space_shrine_@this
		trigger = check_modifier_value
		parameters = { modifier = ship_spth_extra_life }
		mode = add
	}
}
