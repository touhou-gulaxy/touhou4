TH_capture_defender_army = {
    optimize_memory
    set_variable = { which = TH_capture_enemies_count value = TH_planet_defender_count }
    multiply_variable = { which = TH_capture_enemies_count value = $mul$ }
    floor_variable = TH_capture_enemies_count

    create_fleet = {
        name = NAME_TH_captured_armies
        effect = {
            set_owner = $OWNER$
            while = {
                limit = {
                    check_variable = { which = TH_capture_enemies_count value <= 0 }
                }
                create_army_transport = {
                    ship_name = NAME_TH_captured_army
                    army_name = NAME_TH_captured_army
                    army_type = $TYPE$
                    species = owner_species
                }
                subtract_variable = { which = TH_capture_enemies_count value = 1 }
            }
            set_location = {
                target = This
                distance = 45
                angle = random
            }
        }
    }

    clear_variable = TH_capture_enemies_count
}