spth_effect_init_container_country_effect = {
    if = {
        limit = { NOT = { exists = event_target:spth_container_country } }
        create_country = {
            name = NAME_spth_leader_country
            type = spth_country_type_container
            flag = {
				colors = {
					"black"
					"black"
					"null"
					"null"
				}
            }
			effect = {
				save_global_event_target_as = spth_container_country
			}
        }
    }
    event_target:spth_container_country = {
        if = {
            limit = { NOT = { exists = event_target:spth_container_species } }
            create_species = {
	    		name = "NAME_Unknown"
	    		class = HUM
	    		portrait = random
	    		namelist = random
	    		traits = {  }
	    		allow_negative_traits = no
	    		effect = { save_global_event_target_as = spth_container_species }
	    	}
        }
    }
}

spth_debug_trigger_lunar_capital_ruin = {
	optimize_memory
	if = {
		limit = { is_scope_type = country }
		country_event = {
			id = toho.3000
			scopes = {
				from = event_target:spth_story_sol_system_earth
				fromfrom = event_target:spth_story_sol_system_lunar_capital
			}
		}
	}
}

# special project completed effects
# This - ship conducted the project
# From - Project creation location
spth_special_project_research_moon_barrier = {
	optimize_memory
	root.owner = {
		if = {
			limit = { check_variable = { which = spth_research_moon_barrier_var value >= 160 } }
			create_message = {
				type = spth_finish_special_project
				localization = spth_message_finish_special_project_desc
				variable = {
					type = name
					localization = SPTH_LEADER_NAME
					scope = root.leader
				}
				variable = {
					type = key
					value = spth_research_moon_barrier
					localization = SPTH_PROJECT_NAME
				}
				target = root.leader
				recipient = this
				days = 32
			}
			country_event = { id = toho.3001 }
			clear_variable = spth_research_moon_barrier_var
		} else = {
			set_variable = { which = spth_research_moon_barrier_max value = 160 }
			create_message = {
				type = spth_finish_progress_special_project
				localization = spth_message_finish_progress_special_project_desc
				variable = {
					type = name
					localization = SPTH_LEADER_NAME
					scope = root.leader
				}
				variable = {
					type = key
					value = spth_research_moon_barrier
					localization = SPTH_PROJECT_NAME
				}
				variable = {
					type = variable
					varname = spth_research_moon_barrier_var
					localization = SPTH_PROGRESS
					scope = this
				}
				variable = {
					type = variable
					varname = spth_research_moon_barrier_max
					localization = SPTH_TOTAL_PROGRESS
					scope = this
				}
				target = root.leader
				recipient = this
				days = 32
			}
			clear_variable = spth_research_moon_barrier_max
			enable_special_project = {
				name = spth_research_moon_barrier
				location = event_target:spth_story_sol_system_lunar_capital
				owner = this
			}
			root.fleet = {
				fleet_action_research_special_project = {
					special_project = spth_research_moon_barrier
					target = event_target:spth_story_sol_system_lunar_capital
				}
			}
		}
	}
}
spth_special_project_torifune_shield = {
	optimize_memory
	root.owner = {
		# 60%几率失败，但最后一个方案必定成功
		change_variable = { which = spth_disable_habitat_shield_retry value = 1 }
		random_list = {
			60 = {
				modifier = {
					mult = 0
					check_variable = {
						which = spth_disable_habitat_shield_retry
						value >= spth_disable_habitat_shield_count
					}
				}
				create_message = {
					type = spth_finish_progress_special_project
					localization = spth_message_finish_progress_special_project_desc_1
					variable = {
						type = name
						localization = SPTH_SHIP_NAME
						scope = root
					}
					variable = {
						type = variable
						varname = spth_disable_habitat_shield_retry
						localization = SPTH_RETRY_TIMES
						scope = this
					}
					variable = {
						type = key
						value = spth_disable_habitat_shield_2
						localization = SPTH_PROJECT_NAME
					}
					variable = {
						type = variable
						varname = spth_disable_habitat_shield_count
						localization = SPTH_TOTAL_COUNT
						scope = this
					}
					target = this
					recipient = this
					days = 30
				}
				enable_special_project = {
					name = spth_disable_habitat_shield_2
					location = root.from
					owner = root.owner
				}
			}
			40 = {
				create_message = {
					type = spth_finish_special_project
					localization = spth_message_finish_special_project_desc_1
					variable = {
						type = key
						value = spth_disable_habitat_shield_2
						localization = SPTH_PROJECT_NAME
					}
					target = root.from
					recipient = this
					days = 30
				}
				country_event = { id = toho.3007 }
			}
		}
	}
}

# reset ship design: spth_unlock_super_carrier = { reset = yes }
# unlock with flag: spth_unlock_super_carrier = { flag = yes }
# just unlock ship: spth_unlock_super_carrier = yes
spth_unlock_super_carrier = {
	optimize_memory
	[[flag] set_country_flag = can_build_spth_super_carrier]
	# [[reset]
	# 	remove_global_ship_design = NAME_spth_super_carrier_basic
	# 	add_global_ship_design = NAME_spth_super_carrier_basic
	# 	random_owned_ship = {
	# 		limit = { is_ship_size = TH_super_carrier }
	# 		set_ship_design = { design = NAME_spth_super_carrier_basic }
	# 		prev = { remove_ship_design = prev.design }
	# 	}
	# ]
	create_ship_design = { design = NAME_spth_super_carrier_basic }
	add_ship_design = last_created_design
}
