# planet scope
spth_trigger_planet_barrier_capacity_can_hold = {
}

spth_is_gensokyo_city = {
    optimize_memory
    OR = {
        is_planet_class = pc_gensokyo_city
        is_planet_class = pc_ringworld_th
    }
}
spth_is_megastrcuture_habitat = {
    optimize_memory
    OR = {
        is_planet_class = pc_torifune_shrine_habitat
        is_planet_class = pc_space_shrine_habitat
    }
}
spth_is_touhou_habitat = {
    optimize_memory
    is_planet_class = pc_spiritual_power_habitat
}
spth_is_megastructure_planet = {
    optimize_memory
    OR = {
        spth_is_megastrcuture_habitat = yes
        spth_is_touhou_habitat = yes
    }
}
spth_is_touhou_reshape_planet = {
    optimize_memory
    OR = {
        spth_is_gensokyo_city = yes
        is_planet_class = pc_gensokyo_planet
    }
}
spth_is_touhou_planet = {
    optimize_memory
    OR = {
        spth_is_touhou_reshape_planet = yes
        spth_is_megastructure_planet = yes
        is_planet_class = pc_kamikakushi_planet
    }
}

spth_should_close_combat_system = {
    is_invisable_faction = yes
    ag_is_ancient_country = yes
}

is_koishi_critical_factor_low = {
    OR = {
        is_ship_size = frigate
        is_ship_size = corvette
        is_ship_size = destroyer
        is_ship_size = crisis_corvette
        is_ship_size = cosmo_crisis_destroyer
    }
}
is_koishi_critical_factor_mid = {
    OR = {
        is_ship_size = small_ship_fallen_empire
        is_ship_size = cruiser
        is_ship_size = crisis_destroyer
        is_ship_size = crisis_cruiser
    }
}
is_koishi_critical_factor_high = {
    OR = {
        is_ship_size = battleship
        is_ship_size = titan
        is_ship_size = large_ship_fallen_empire
        is_ship_size = massive_ship_fallen_empire
        is_ship_size = TH_battle_cruiser
        is_ship_size = cosmo_crisis_battlecruiser
        is_ship_size = cosmo_crisis_titan
    }
}
is_koishi_critical_factor_extra = {
    OR = {
        is_ship_class = shipclass_starbase
        is_ship_size = spth_ur_didact_flagship
        is_ship_size = spth_cr_dreadnought
        is_ship_size = colossus
        is_ship_size = star_eater
        is_ship_size = juggernaut
        is_ship_size = th_juggernaut
    }
}
is_koishi_original_ships = {
    OR = {
        is_ship_size = frigate
        is_ship_size = corvette
        is_ship_size = destroyer
        is_ship_size = crisis_corvette
        is_ship_size = cosmo_crisis_destroyer
        is_ship_size = small_ship_fallen_empire
        is_ship_size = cruiser
        is_ship_size = crisis_destroyer
        is_ship_size = crisis_cruiser
        is_ship_size = battleship
        is_ship_size = titan
        is_ship_size = large_ship_fallen_empire
        is_ship_size = massive_ship_fallen_empire
        is_ship_size = TH_battle_cruiser
        is_ship_size = cosmo_crisis_battlecruiser
        is_ship_size = cosmo_crisis_titan
    }
}
# 预留给幻想乡季节相关事件
# 如剧情线检测季节触发春雪异变
spth_is_specified_season = {
    optimize_memory
    OR = {
        [[winter] spth_is_winter = $winter$ ]
        [[spring] spth_is_spring = $spring$ ]
        [[summer] spth_is_summer = $summer$ ]
        [[autumn] spth_is_autumn = $autumn$ ]
    }
}
spth_is_winter = {
    optimize_memory
    fail_text = trigger_in_winter_failed
    success_text = trigger_in_winter_success
    OR = {
        check_variable_arithmetic = {
            which = value:spth_current_month
            value > 11
        }
        check_variable_arithmetic = {
            which = value:spth_current_month
            value < 3
        }
    }
}
spth_is_spring = {
    optimize_memory
    fail_text = trigger_in_spring_failed
    success_text = trigger_in_spring_success
    check_variable_arithmetic = {
        which = value:spth_current_month
        value > 2
    }
    check_variable_arithmetic = {
        which = value:spth_current_month
        value < 6
    }
}
spth_is_summer = {
    optimize_memory
    fail_text = trigger_in_summer_failed
    success_text = trigger_in_summer_success
    check_variable_arithmetic = {
        which = value:spth_current_month
        value > 5
    }
    check_variable_arithmetic = {
        which = value:spth_current_month
        value < 9
    }
}
spth_is_autumn = {
    optimize_memory
    fail_text = trigger_in_autumn_failed
    success_text = trigger_in_autumn_success
    check_variable_arithmetic = {
        which = value:spth_current_month
        value > 8
    }
    check_variable_arithmetic = {
        which = value:spth_current_month
        value < 12
    }
}
spth_has_crisis_effect_weapon = {
    optimize_memory
    OR = {
        has_component = spth_story_crisis_titan_kinetic_weapon
        has_component = spth_story_crisis_titan_energy_weapon
        has_component = spth_story_crisis_titan_generic_weapon
        has_component = spth_story_crisis_extra_kinetic_weapon
        has_component = spth_story_crisis_extra_energy_weapon
        has_component = spth_story_crisis_extra_generic_weapon
        has_component = spth_story_crisis_g_weapon
        has_component = spth_story_crisis_flagship_computer
        has_component = spth_story_crisis_dreadnought_computer
    }
}
spth_has_shield_armor_efficiency_component = {
    optimize_memory
    OR = {
        has_component = spth_story_crisis_dreadnought_computer
        has_component = spth_story_crisis_titan_energy_weapon
    }
}
# 引导信标检测
has_spth_bombardment_beacon = {
    optimize_memory
    NOT = { has_fleet_flag = has_spth_bombardment_support }
    any_owned_ship = {
        OR = {
            has_component = spth_story_crisis_dreadnought_computer
            has_component = spth_story_crisis_flagship_computer
            has_component = spth_hv_bombardment_beacon
            has_component = spth_super_carrier_computer
            has_ship_flag = has_spth_bombardment_beacon
        }
    }
}
# 跨星系火力检测
# 支援船最大射程为3
# this = combat fleet
can_enable_spth_bombardment_support = {
    optimize_memory
    NOT = { any_owned_ship = { is_ship_size = spth_hv_bombardment_ship } }
    owner = {
        any_owned_fleet = {
            distance = {
                source = prevprev
                type = hyperlane
                max_jumps <= 3
            }
            any_owned_ship = {
                is_ship_size = spth_hv_bombardment_ship
            }
        }
    }
}
is_spth_bombardment_support_fleet = {
    optimize_memory
    distance = {
        source = prevprev
        type = hyperlane
        max_jumps <= 3
    }
    any_owned_ship = {
        is_ship_size = spth_hv_bombardment_ship
    }
}
spth_subcapital_allow_pretrigger = {
    optimize_memory
    OR = {
        num_pops >= 40
        has_building = building_spth_old_shirne
        has_building = building_spth_planet_shirne
        has_building = building_major_capital
        has_building = building_system_capital_nanotech
    }
}

# colony designation check (prepared for future use)
spth_has_farming_designation = {
    OR = {
        has_designation = col_farming
        has_designation = col_ring_farming
        has_designation = col_habitat_farming
        has_designation = col_habitat_gestalt_farming
    }
}

spth_has_fortress_designation = {
    or = {
        has_designation = col_fortress
        has_designation = col_habitat_fortress
    }
}

spth_has_factory_designation = {
    OR = {
        has_designation = col_spth_capital_factory
        has_designation = col_spth_factory
        has_designation = col_spth_factory_city
        has_designation = col_capital_factory
        has_designation = col_factory
        has_designation = col_mac_factory
        has_designation = col_ecu_factory
        has_designation = col_habitat_factory
    }
}

spth_has_foundry_designation = {
    OR = {
        has_designation = col_spth_capital_foundry
        has_designation = col_spth_foundry
        has_designation = col_spth_foundry_city
        has_designation = col_capital_foundry
        has_designation = col_foundry
        has_designation = col_ecu_foundry
        has_designation = col_habitat_foundry
        has_designation = col_mac_foundry
        has_designation = col_hiv_foundry
    }
}

spth_has_generator_designation = {
    OR = {
        has_designation = col_generator
        has_designation = col_habitat_energy
        has_designation = col_ring_generator
    }
}

spth_has_industrial_designation = {
    OR = {
        has_designation = col_industrial
        has_designation = col_habitat_industrial
        has_designation = col_ecu_industrial
    }
}

spth_has_mining_designation = {
    OR = {
        has_designation = col_habitat_mining
        has_designation = col_mining
    }
}

spth_has_refinery_designation = {
    OR = {
        has_designation = col_spth_refine
        has_designation = col_spth_refine_city
        has_designation = col_refinery
        has_designation = col_habitat_refinery
    }
}

spth_has_research_designation = {
    OR = {
        has_designation = col_spth_research
        has_designation = col_spth_research_city
        has_designation = col_research
        has_designation = col_ring_research
        has_designation = col_habitat_research
        has_designation = col_ecu_research
    }
}

spth_has_unity_designation = {
    OR = {
        has_designation = col_bureau
        has_designation = col_habitat_bureau
        has_designation = col_bureau_machine
        has_designation = col_trophy_machine
        has_designation = col_habitat_bureau_machine
        has_designation = col_bureau_hive
        has_designation = col_habitat_bureau_hive
        has_designation = col_bureau_spiritualist
        has_designation = col_habitat_bureau_spiritualist
    }
}

spth_has_rural_designation = {
    OR = {
        has_designation = col_spth_capital
        has_designation = col_spth_capital_extraction
        has_designation = col_spth_basis
        has_designation = col_spth_basis_city
        has_designation = col_capital_extraction
        has_designation = col_rural
        has_designation = col_rural_gestalt
        has_designation = col_hiv
        has_designation = col_mac
    }
}

spth_has_trade_designation = {
    OR = {
        has_designation = col_spth_capital_trade
        has_designation = col_capital_trade
        has_designation = col_city
        has_designation = col_habitat_trade
        has_designation = col_ring_trade
        has_designation = col_ecu_mix
    }
}
