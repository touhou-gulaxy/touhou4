namespace = gensokyo_start
###开局科技
country_event = {
	id = gensokyo_start.0
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_authority = auth_gensokyo
		NOT = { has_origin = origin_spth_story_gensokyo }
	}

	immediate = {
		add_research_option = tech_spth_spirit_power_beginning
		give_technology = { tech = "tech_th_weapon_mofashu" message = no }
		if = {
			limit = {
				has_civic = civic_scarlet_devil
			}
			give_technology = { tech = "tech_worker_0" message = no }
			give_technology = { tech = "tech_specialist_0" message = no }
		}
		else_if = {
			limit = {
				has_civic = civic_gensokyo
			}
            unlock_council_slots = 1
			give_technology = { tech = "tech_worker_0" message = no }
		}
		capital_scope = {
			while = { count = 4 create_pop = { species = owner.founder_species } }
			spth_effect_establish_barrier = yes
			add_building = building_spth_cloner
			add_building = building_spth_common_foundry
			add_building = building_spth_mining_centre
			remove_building = building_research_lab_1
			add_building = building_spth_research_base_1
			remove_building = building_bureaucratic_1
			add_building = building_spth_tavern
			remove_building = building_commercial_zone
			while = { count = 3 remove_district = district_city }
			while = { count = 2 remove_district = district_farming }
			while = { count = 2 remove_district = district_mining }
			while = { count = 2 remove_district = district_generator }
			while = { count = 4 add_district = district_spth_human_village }
			while = { count = 3 add_district = district_spth_generic_factory }
			while = { count = 2 add_district = district_spth_sp_produce }
		}
	}
}
### 幻想之星起源开局，幻想城区划
country_event = {
	id = gensokyo_start.1
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_authority = auth_gensokyo
		has_country_flag = origin_gensokyo_city_flag
	}

	immediate = {
		random_owned_planet = {
			limit = {
				is_planet_class = pc_gensokyo_city
			}
			remove_all_districts = yes
			clear_blockers = yes
			clear_deposits = yes
			add_deposit = d_spirit_power_spring
			add_deposit = d_hakurajinjia
			add_deposit = d_mosen
			add_deposit = d_yokai_mountain
			add_deposit = d_renli
			add_deposit = d_zhulin
			add_deposit = d_th_underway
			add_district = district_gensokyo_renli
			add_district = district_gensokyo_jinja
			save_event_target_as = new_pc_gensokyo_city
			if = {
				limit = {
					owner = {
						is_ai = yes
						NOT = {
							has_global_flag = spth_AI_NOT_plus
						}
					}
				}
				remove_building = building_bureaucratic_1
				remove_building = building_research_lab_1
				remove_building = building_foundry_1
				remove_building = building_factory_1
				add_district = district_gensokyo_jinja
				add_district = district_gensokyo_tushu
			}
		}
		event_target:new_pc_gensokyo_city = {
			create_ambient_object = {
				type = "th_gensokyo_mofazhen_object"
				entity_offset_height = { min = -35 max = -40 }
				location = this
			}
			last_created_ambient_object = {
				set_location = {
					target = event_target:new_pc_gensokyo_city
				}
			}
		}
		capital_scope = {
			add_modifier = {
				modifier = spth_gsk_start_grow
				years = 15
			}
		}
	}
}
### 幻想扩散起源开局
country_event = {
	id = gensokyo_start.2
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_authority = auth_gensokyo
	}

	immediate = {
		if = {
			limit = { has_origin = origin_th_hm_default}
			every_owned_planet = {
				add_building = building_hmgfb_1
				if = {
					limit = {
						owner = {
							is_ai = yes
							NOT = {
								has_global_flag = spth_AI_NOT_plus
							}
						}
					}
					remove_building = building_bureaucratic_1
					add_building = building_hmgfb_2
					set_planet_flag = hm_num_2
				}
			}
			set_country_flag = th_hm_default_origin
		}
		if = {
			limit = { has_origin = origin_gensokyo_resource}
			
			give_technology = { tech = "tech_gensokyo_building_1" message = no }
			give_technology = { tech = "tech_gensokyo_building_2" message = no }
			give_technology = { tech = "tech_gensokyo_building_3" message = no }
			give_technology = { tech = "tech_gensokyo_building_4" message = no }
			give_technology = { tech = "tech_th_lingli_storage" message = no }
			add_resource = {
				sr_lingli = 3000
				sr_fuka = 2000
				alloys = 10000
				consumer_goods = 10000
				energy = 5000
				minerals = 5000
				food = 5000
			}
			capital_scope = {
				if = {
					limit = {
						owner = {
							is_ai = yes
							NOT = {
								has_global_flag = spth_AI_NOT_plus
							}
						}
					}
					remove_building = building_bureaucratic_1
					remove_building = building_research_lab_1
					remove_building = building_foundry_1
					add_building = building_spth_research_base_1
					add_building = building_spth_common_foundry
					add_building = building_spth_common_factory
					add_building = building_spth_cloner
				}
				add_modifier = {
					modifier = spth_gsk_start_grow
					years = 10
				}
			}
		}
		if = {
			limit = { has_origin = origin_th_hm_trad}
			add_tradition = tr_supremacy_adopt
			add_tradition = tr_supremacy_fleet_logistical_corps
			add_tradition = tr_supremacy_master_shipwrights
			add_tradition = tr_supremacy_war_games
			add_tradition = tr_supremacy_overwhelming_force
			add_tradition = tr_supremacy_great_game

			add_tradition = tr_expansion_adopt
			add_tradition = tr_expansion_colonization_fever
			add_tradition = tr_expansion_a_new_life
			add_tradition = tr_expansion_courier_network
			add_tradition = tr_expansion_reach_for_the_stars
			add_tradition = tr_expansion_galactic_ambition
			
			capital_scope = {
				add_modifier = {
					modifier = spth_hm_start_grow
					years = 25
				}
				if = {
					limit = { 
						owner = {
							is_ai = yes
							NOT = {
								has_global_flag = spth_AI_NOT_plus
							}
						}
					}
					remove_building = building_bureaucratic_1
					add_building = building_hmgfb_2
					add_building = building_hmgfb_1
					set_planet_flag = hm_num_2
				}
			}
		}
	}
}
### AI增强开关
country_event = {
	id = gensokyo_start.3
	title = gensokyo_start.3.name
	desc = gensokyo_start.3.desc
	picture = GFX_evt_th_alice
	is_triggered_only = yes
	trigger = {
		is_ai = no
	}
	option = {
		name = th_pop.0.end
		trigger = {
			NOT = {
				has_global_flag = spth_AI_NOT_plus
			}
			is_ai = no
		}
		hidden_effect = {
			country_event = {
				id = gensokyo_start.3
			}
			set_global_flag = spth_AI_NOT_plus
			set_global_flag = spth_allow_non_disappear_barrier_story
		}
	}
	option = {
		name = th_pop.0.on
		trigger = {
			has_global_flag = spth_AI_NOT_plus
			is_ai = no
		}
		hidden_effect = {
			country_event = {
				id = gensokyo_start.3
			}
			remove_global_flag = spth_AI_NOT_plus
			remove_global_flag = spth_allow_non_disappear_barrier_story
		}
	}
	# option = {
	# 	name = th_crisis_AI.on
	# 	trigger = {
	# 		has_global_flag = spth_AI_NOT_crisis
	# 		is_ai = no
	# 	}
	# 	hidden_effect = {
	# 		country_event = {
	# 			id = spth_crisis_AI.0
	# 		}
	# 		remove_global_flag = spth_AI_NOT_plus
	# 	}
	# }
	option = {
		name = th_pop.0.a
		# hidden_effect = {
		# 	if = {
		# 		limit = {
		# 			OR = {
		# 				any_country = { has_origin = origin_spth_story_gensokyo }
		# 				is_multiplayer = yes
		# 			}
		# 		}
		# 		remove_global_flag = spth_allow_non_disappear_barrier_story
		# 	}
		# 	country_event = { id = gensokyo_start.6 }
		# }
	}
}
### 用来检测触发gensokyo_start.3
country_event = {
	id = gensokyo_start.4
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_ai = yes
		has_authority = auth_gensokyo
	}
	fire_only_once = yes
	immediate = {
		random_country = {
			limit = {
				is_ai = no
			}
			country_event = {
				id = gensokyo_start.3
			}
		}
	}
}

# 生成一个用来临时存储要生成的领袖以及一个备用基底物种的国家
event = { 
    id = gensokyo_start.5
	hide_window = yes
	is_triggered_only = yes
    immediate = {
        spth_effect_init_container_country_effect = yes
    }
}

country_event = {
	id = gensokyo_start.6
	title = gensokyo_start.6.name
	desc = gensokyo_start.6.desc
	picture = GFX_evt_hakurei_shrine_in_night
	auto_select = no
	is_triggered_only = yes
	trigger = {
		NOT = { has_origin = origin_spth_story_gensokyo }
		has_global_flag = spth_allow_non_disappear_barrier_story
	}
	option = {
		name = gensokyo_start.6.a
		country_event = { id = gensokyo_start.7 days = 30 random = 30 }
	}
	option = {
		name = gensokyo_start.6.b
		hidden_effect = {
			remove_global_flag = spth_allow_non_disappear_barrier_story
		}
	}
}
# 非起源主事件链触发
# 设定上为剧情玩家离开宇宙之后
# 母星周围刷出除了地球都被护盾屏蔽的剧情太阳系
# 殖民、挖完秘封坟，给玩家灵力产出建筑，告诉玩家需要进一步研究
# 接触幻想乡AI后买科技/挖完坟15年+解锁超级护盾/幻想乡国家研究完灵力护盾后，
# 准许研究灵力护盾特殊项目，解锁月之都和鸟船
# 挖修改过的月都和鸟船坟，遗存记录显示和秘封有关，之后进入主事件链
# 最终天灾需要修改，变为看守通往第四面墙之外秘密的计算机AI。
country_event = {
	id = gensokyo_start.7
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = spth_allow_non_disappear_barrier_story
	}
	immediate = {
		set_spawn_system_batch = begin
		capital_star.solar_system = {
			spawn_system = {
				initializer = spth_story_sol_system_gensokyo
				hyperlane = no
				min_orientation_angle = 0
				max_orientation_angle = 360
				max_distance = 16
				min_distance = 64
			}
			last_created_system = {
				add_hyperlane = {
					from = this
					to = prev
				}
				set_star_flag = non_origin_spth_story_sol_system
				event_target:spth_story_sol_system_lunar_capital = {
					change_pc = pc_shielded
				}
			}
		}
		set_spawn_system_batch = end
	}
}

# 用来放mod说明和更新公告的开局事件
country_event = {
	id = gensokyo_start.100
	title = gensokyo_start.100.name
	desc = gensokyo_start.100.desc
	picture = GFX_evt_th_alice
	is_triggered_only = yes
	trigger = {
		has_authority = auth_gensokyo
		is_ai = no
	}
	option = {
		name = gensokyo_start.100.a
	}
	option = {
		name = gensokyo_start.100.b
		country_event = { id = gensokyo_start.101 }
	}
}
country_event = {
	id = gensokyo_start.101
	title = gensokyo_start.101.name
	desc = gensokyo_start.101.desc
	picture = GFX_evt_th_alice
	is_triggered_only = yes
	trigger = {
		has_authority = auth_gensokyo
		is_ai = no
	}
	option = {
		name = gensokyo_start.101.a
		hidden_effect = {
			country_event = { id = gensokyo_start.100 }
		}
	}
}
